#Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') #EmbedPress

from bs4 import BeautifulSoup
import re
import requests
import sys
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
requests.adapters.DEFAULT_RETRIES = 2
n = len(sys.argv)

x = '''

███████╗███╗░░░███╗██████╗░███████╗██████╗░██████╗░██████╗░███████╗░██████╗░██████╗
██╔════╝████╗░████║██╔══██╗██╔════╝██╔══██╗██╔══██╗██╔══██╗██╔════╝██╔════╝██╔════╝
█████╗░░██╔████╔██║██████╦╝█████╗░░██║░░██║██████╔╝██████╔╝█████╗░░╚█████╗░╚█████╗░
██╔══╝░░██║╚██╔╝██║██╔══██╗██╔══╝░░██║░░██║██╔═══╝░██╔══██╗██╔══╝░░░╚═══██╗░╚═══██╗
███████╗██║░╚═╝░██║██████╦╝███████╗██████╔╝██║░░░░░██║░░██║███████╗██████╔╝██████╔╝
╚══════╝╚═╝░░░░░╚═╝╚═════╝░╚══════╝╚═════╝░╚═╝░░░░░╚═╝░░╚═╝╚══════╝╚═════╝░╚═════╝░
'''

print(x)

target = sys.argv[1]
#target = "http://192.168.37.161"
target = target+"/wp-content/plugins/embedpress/readme.txt"
#print(target)

try:
    response = requests.get(f"{target}",verify=False)
    if response.status_code == 200:
        soup = BeautifulSoup(response.text,'html.parser')
        output = soup.get_text()
        flag = 0
        for i in output.splitlines():
            version = re.search(r'(\d+).(\d+).(\d+)',i)
            if version:
                if "[" in i and "]" in i and "=" in i:
                    flag = 1
                    v = version.group()
                    x1 = v.split(".")
                    x2 = int(x1[0])
                    x3 = int(x1[1])
                    x4 = int(x1[2])
                    if x2 <= 3 and x3 <=9 and x4 < 2:
                        print('Found Following Version for Plugin EmbedPress : '+str(x2)+'.'+str(x3)+'.'+str(x4)+' Which appears to be vulnerable to Cross-site Scripting*')
                        print("For More details visit https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/embedpress/draft-vulnerability-for-embedpress-392")
                    else:
                        print('Found Following Version for Plugin EmbedPress : '+str(x2)+'.'+str(x3)+'.'+str(x4)+' Which does not appears to be vulnerable')
                        print("For More details visit https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/embedpress/draft-vulnerability-for-embedpress-392")
            if flag == 1:
                break
    else:
        print("Server Not Available",response.status_code)
except Exception as e:
    print("Please Check URL",e)


